<!doctype html>

<!-- ASSIGN OUR ANGULAR MODULE -->
<html ng-app="scotchTodo">
<head>
	<!-- META -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"><!-- Optimize mobile viewport -->

	<title>MEETAPP</title>

	<!-- SCROLLS -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"><!-- load bootstrap -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
	<style>
		html 					{ overflow-y:scroll; }
		body 					{ padding-top:50px; }
		#todo-list 				{ margin-bottom:30px; }
		#todo-form 	 			{ margin-bottom:50px; }
	</style>

	<!-- SPELLS -->
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script><!-- load angular -->

	<script src="js/controllers/main.js"></script> <!-- load up our controller -->
	<script src="js/core.js"></script> <!-- load our main application -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://connect.facebook.com/en_US/messenger.Extensions.js"></script>
</head>
<!-- SET THE CONTROLLER -->
<body ng-controller="mainController">
<script>
		var context = {}
		$(document).ready(function(){MessengerExtensions.getContext('131709420816962',
 		 function success(thread_context){
 		 	context = thread_context;
			document.getElementById("mapholder").innerHTML = JSON.stringify(context);
		    	$.ajax({
			    url: '/state',
			    data: context,
			    type: 'POST',
			    cache: false,
			    success: function(response) {
			    var state = response;
			    if (state.state===1){
			    	$('.page1').hide();
				$('.page2').show();
				$('#ppref').html("You want to mee at a "+state.preference);
			    }
			    if(state.state === 0){
				    $('.page1').show();
				    $('.page2').hide();
				    console.log(response);
			    }
			    else{
				    $('#demo').html(JSON.stringify(response));
			    }
			    },
			    error: function(error) {
				console.log(error);
			    }
			});

 		 },
 		 function error(err){
 		    // error
 		  }
		 );
		$('#preference').click(function(e){
			$('#demo').html("CLicked Prefbut");
			var pref = $("#textPref").val()
		    	$.ajax({
			    url: '/preference',
			    data: {'c':context,'pref':pref},
			    cache: false,
			    type: 'POST',
			    success: function(response) {
			    			    },
			    error: function(error) {
				console.log(error);
			    }
			});
		});
		$('#locButton').click(function(e){
			$.ajax({
				url:'/getloc',
				cache: false,
				type: 'GET',
				success: function(response){
				},
				error: function(error){
                                      console.log(error);
				}
		}
});
</script>

	<div class="page1 container">

		<!-- HEADER AND TODO COUNT -->
		<h1>Where do you want to meet?</h1>
		<div id="todo-form" class="row">
			<form>
				<div class="form-group">

					<input type="text" class="form-control input-lg text-center" id="textPref" placeholder="cafe or bar or whatever" ng-model="formData.text">
				</div>

				<!-- createToDo() WILL CREATE NEW TODOS -->
				<button type="input" class="btn btn-primary btn-lg" id="preference">Proceed</button>
				<p id="demo">results here</p>
				<div id="mapholder"></div>
			</form>
		</div>


	</div>
	<div class="page2 container">
		<h1>Update Locations</h1>
		<h3>Share this link in the chat window so your friends can add their locations</h3>
		<div id = "locList">
		</div>
		<button type="input" class="btn btn-primary btn-lg" id="locButton">Add/update my location</button>
		<p id="ppref"></p>
	</div>

</body>
</html>
